class SharePost{constructor(t){this.toggler=t,this.postShare()}postShare(){let t=$(this.toggler);t.submit((function(s){console.log("share f 2"),s.preventDefault(),$.ajax({type:"post",url:t.prop("action"),data:t.serialize()}).done((function(s){if(console.log(s.data),s.error)return void new Noty({theme:"relax",text:"An empty content is rebellion!",type:"error",layput:"topRight",timeout:1500}).show();if($(".modal-backdrop").remove(),$("body").removeClass("modal-open"),$(`#post-${s.data.originalPostID}-share-modal`).modal("hide"),!s.data.valid)return void new Noty({theme:"relax",text:"The original post now resides in heaven!",type:"error",layput:"topRight",timeout:1500}).show();let e=parseInt(t.attr("data-shares"));e+=1;let a=s.data.newWholePost;$(`#post-${s.data.originalPostID}-shares-number .post-shares-no-display`).html(""+e),$(`#post-${s.data.originalPostID}-share-title span`).html(e+' <i class="fas fa-share-square"></i>'),new Noty({theme:"relax",text:"They say, sharing is caring!",type:"success",layput:"topRight",timeout:1500}).show();let o=$(`\n\n                <li class="post-list animated-box in" id="post-${a._id}">\n                   \n                <div class="post-like-box">\n                    <div class="post-likes-number" id="post-${a._id}-likes-number">\n                        <span data-target="#post-${a._id}-likes" data-toggle="modal"></span>\n                        <a class="toggle-like-button" href="/likes/toggle/?id=${a._id}&type=Post" data-likes="0">\n                            <i class="fas fa-thumbs-up like-thumbs"></i>\n                        </a>\n                    </div>\n                    <div class="modal fade" id="post-${a._id}-likes" role="dialog">\n                        <div class="modal-dialog">\n                        \n                        \x3c!-- Modal content--\x3e\n                        <div class="modal-content">\n                            <div class="modal-header">\n                            <h4 class="modal-title" id="post-${a._id}-like-title">Post Reactions  \n                                <span><i class="far fa-heart"></i></span></h4>\n                            </div>\n                            <div class="modal-body">\n                                <ul  class="post-like-username-list" id="post-${a._id}-likes-list">\n                                    \n                            \n                                </ul>\n                            </div>\n                        \n                        </div>\n                        \n                        </div>\n                  </div>\n           \n            \n                </div>\n                \n                <small class="post-deletion"> \n                <span data-toggle="modal" data-target="#post-${a._id}-delete-modal" class="delete-post-modal">\n        <i class="fas fa-trash-alt"></i>\n    </span>\n    <div class="modal fade post-delete-modal" tabindex="-1" role="dialog" id="post-${a._id}-delete-modal">\n        <div class="modal-dialog" role="document">\n          <div class="modal-content">\n            <div class="modal-header">\n              <h2 class="modal-title"><i class="fas fa-trash-alt"></i> Post?</h2>\n            </div>\n            <div class="modal-body">\n              <p>Are you sure you want to delete it?</p>\n            </div>\n            <div class="modal-footer">\n              <a href="/posts/destroy-post/${a._id}" class="delete-post-button btn btn-danger" data-dismiss="modal">Remove</a>\n              <button type="button" class="btn btn-light" data-dismiss="modal">Discard</button>\n            </div>\n          </div>\n        </div>\n      </div>\n                </small>\n                <small class="updateposttag"> \n                    <a href="/posts/update-post/${a._id}" class="update-post-button">\n                        <i class="fas fa-pen-fancy"></i>\n                    </a>\n                </small>\n                <small class="author-post-name">\n                    <a href="/users/profile/${s.data.newUserID}">\n                       \n                        <span>${s.data.newUserName}</span>\n                    </a>\n                </small>\n        \n                <div class="post-content" id="post-${a._id}-content">\n                 \n                    <div class="post-text">\n                       <span> ${a.content.newContent}</span>\n                       <div class="copiedPost">\n                                <div class="copiedAuthIntro">\n                                    <a href="/users/profile/${a.content.prevAuthID}">\n                                        <span>${a.content.prevAuthName}</span>\n                                       \n                                    </a>\n                                </div>\n                                <p>${a.content.prevAuthContent}</p>\n                        </div>\n                    </div>\n                    <div class="post-comments">\n                        <form action="/comments/create-comment" method="post" id="post-${a._id}-comments-form">\n                            <textarea type="text" name="content" placeholder="Type here to add comment...." required onkeydown="autosize1(this)"></textarea>\n                            <input type="hidden" name="post" value="${a._id}">\n                            <button type="submit">Add comment</button>\n                        </form>\n                        <div class="post-comment-number" id="post-${a._id}-comment-number" data-comments="0" data-target="#post-comments-${a._id}-list" >\n                        <span >\n                          \n                        </span>\n                        <i class="fas fa-comments"></i>\n                    </div>\n                    </div>\n                    <div class="post-comments-list collapse" id="post-comments-${a._id}-list">\n                        <ul id="post-comments-${a._id}">\n                           \n                        </ul>\n                \n                    </div>\n                </div>\n                <div class="post-timestamps">\n                    ${s.data.newPostDate}\n                </div>\n                <div class="post-share-box">\n              \n                <div class="post-shares-number" id="post- ${a._id}-shares-number">\n                    <span data-toggle="modal" data-target="#post-${a.content.prevPostId}-share-modal">\n                       \n                        <i class="fas fa-share-square"></i>\n                    </span>\n                </div>\n                </li>`);t.attr("data-shares",e);let n=$(`<li id="share-${s.data.shareID}"><a href="/users/profile/${s.data.userID}">\n                    <span>${s.data.newUserName}</span>\n                </a></li>`);s.data.newUserImage?($(" .author-post-name a",o).prepend(`<img src=${s.data.newUserImage}>`),$(" a",n).prepend("<img src="+s.data.newUserImage)):($(" .author-post-name a",o).prepend(`<span class="concealed-image" style="background:${s.data.newUserBgColor}"><span>${s.data.newUserName.split(" ")[0].charAt(0)}</span></span>`),$(" a",n).prepend(` <div class="concealed-image" style="background:${s.data.newUserBgColor};"><span>${s.data.newUserName.split(" ")[0].charAt(0)}</span></div>`)),a.content.prevAuthImage?$(" .copiedPost a",o).append(`<img src="${a.content.prevAuthImage}"> `):$(" .copiedPost a",o).append(`<div class="concealed-image" style="background:${a.content.prevAuthBgColor}"><span>${a.content.prevAuthName.split(" ")[0].charAt(0)}</span></div>`),$(`#post-${s.data.originalPostID}-shares-list`).prepend(n),$("#posts-list-container>ul").prepend(o),$(`#post-${s.data.originalPostID}-share-title span`).html(e+'  <i class="fas fa-share"></i>'),new ToggleLike($(" .toggle-like-button",o)),new SharePost($(" .toggle-share-button",o)),new PostComments(s.data.newWholePost._id);var l;l=$(" .delete-post-button",o),console.log(l),$(l).click((function(t){t.preventDefault(),$.ajax({type:"get",url:$(l).prop("href"),success:function(t){if(console.log(t.data),$("#post-"+t.data.postID).remove(),null!=t.data.shareID){let s=parseInt($(`#post-${t.data.originalPostID}-share-form`).attr("data-shares"));console.log("del share post",s),s-=1,console.log("del share 2",s),$(`#post-${t.data.originalPostID}-share-form`).attr("data-shares",s),console.log("del share form attr",$(`#post-${t.data.originalPostID}-share-form`).attr("data-shares")),s>0?($(`#post-${t.data.originalPostID}-shares-number .post-shares-no-display`).html(""+s),$(`#post-${t.data.originalPostID}-share-title span`).html(s+'  <i class="fas fa-share"></i>')):$(`#post-${t.data.originalPostID}-shares-number .post-shares-no-display`).html(""),$("#share-"+t.data.shareID).remove()}$(".modal-backdrop").remove(),$("body").removeClass("modal-open"),new Noty({theme:"relax",text:"This post and its company needs a funeral!",type:"success",layput:"topRight",timeout:1500}).show()},error:function(t){console.log("share post delete",t.responseText)}})}));var d;d=$(" .update-post-button",o),$(d).click((function(t){t.preventDefault(),$.ajax({type:"post",url:$(d).prop("href"),success:function(t){console.log(t.data),$("#posts-list-container>ul>li").each((function(){let t=$(this),s=$(" .updateposttag",t);console.log(s);let e=$(" .update-post-button",s);console.log(e),e.css("pointer-events","none"),s.css("cursor","no-drop")})),$(`#post-${t.data.postID} .post-deletion`).css("cursor","no-drop"),$(`#post-${t.data.postID} .post-deletion span`).css("pointer-events","none"),$(`#post-${t.data.postID}-content .post-text > span`).remove(),$(`#post-${t.data.postID}-content .post-text`).prepend(`<form action="/posts/update-post-p2" method="post" class="post-update-form">\n                                <textarea required  name="content" onkeydown="autosize1(this)">${t.data.content.newContent}</textarea>\n                                    <input type="hidden" name="post" value="${t.data.postID}">\n                                    <button type="submit">Update</button>\n                                    </form>`),i()},error:function(t){console.log("share update erro",t.responseText)}})}));let i=function(){$(".post-update-form").submit((function(t){t.preventDefault(),$.ajax({type:"post",url:"/posts/update-post-p2",data:$(".post-update-form").serialize(),success:function(t){console.log(t.data),$("#posts-list-container>ul>li").each((function(){let t=$(this),s=$(" .updateposttag",t);console.log(s);let e=$(" .update-post-button",s);console.log(e),e.css("pointer-events","auto"),s.css("cursor","pointer")})),$(`#post-${t.data.postID} .post-deletion`).css("cursor","pointer"),$(`#post-${t.data.postID} .post-deletion span`).css("pointer-events","all"),t.data.edited&&$("#post-"+t.data.postID).prepend('<small class="post-editedTag">\n                                            Edited\n                                            </small>'),$(`#post-${t.data.postID}-content .post-text form`).remove(),$(`#post-${t.data.postID}-content .post-text`).prepend(`<span>${t.data.content}</span>`),new Noty({theme:"relax",text:"Post had a successful affair of words!",type:"success",layput:"topRight",timeout:1500}).show()},error:function(t){console.log("update share ",t.responseText)}})}))}})).fail((function(t){console.log("error in completing the request ",t)}))}))}}