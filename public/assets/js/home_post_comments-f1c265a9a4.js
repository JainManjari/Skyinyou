class PostComments{constructor(t){this.postId=t,this.postContainer=$("#post-"+t),this.newCommentForm=$(`#post-${t}-comments-form`),this.createComment(t);let e=this;$(" .delete-comment-button",this.postContainer).each((function(){e.deleteComment($(this)),console.log("del comments")})),$(" .update-comment-button",this.postContainer).each((function(){e.updateComment($(this)),console.log("updating comments")}))}createComment(t){let e=this;this.newCommentForm.submit((function(n){n.preventDefault();$.ajax({type:"post",url:"/comments/create-comment",data:$(this).serialize(),success:function(n){console.log("creating comment ",n.data);let o=n.data.comment;n.data.comment.user._id==n.data.post.user._id?(o.authorTag="author-tag",o.author="Author"):(o.authorTag="",o.author="");var a=new Date(n.data.comment.createdAt);o.createdAt=a.toLocaleString();let m=e.newCommentDom(o);n.data.comment.user.avatar?$(" .author-comment-name a",m).prepend(`<img src=${n.data.comment.user.avatar}>`):$(" .author-comment-name a",m).prepend(`<div class="concealed-image" style="background:${n.data.comment.user.info.bgColor}"><span>${n.data.comment.user.name.split(" ")[0].charAt(0)}</span></div>`),$("#post-comments-"+t).prepend(m);let s=parseInt($(`#post-${t}-comment-number`).attr("data-comments"));s+=1,$(`#post-${t}-comment-number`).attr("data-comments",s),$(`#post-${t}-comment-number`).attr("data-toggle","collapse"),$(`#post-${t}-comment-number`).html(`<span>${s}</span> <i class="fas fa-comments"></i>`),e.deleteComment($(" .delete-comment-button",m)),e.updateComment($(" .update-comment-button",m)),new ToggleLike($(" .toggle-like-button",m)),new Noty({theme:"relax",text:"Congrats, now you are the parent of this baby!",type:"success",layout:"topRight",timeout:1800}).show()},error:function(t){console.log(t.responseText)}})}))}newCommentDom(t){return $(`<li id="comment-${t._id}" class="comment-list">\n\n        <div class="comment-like-box">\n                <div class="comment-likes-number" id="comment-${t._id}-likes-number">\n                    <span data-target="#comment-${t._id}-likes" data-toggle="modal"></span>\n                    <a class="toggle-like-button" href="/likes/toggle/?id=${t._id}&type=Comment" data-likes="0">\n                        <i class="fas fa-thumbs-up like-thumbs"></i>\n                    </a>\n                </div>\n\n                <div class="modal fade" id="comment-${t._id}-likes" role="dialog">\n                    <div class="modal-dialog">\n                    \n                    \x3c!-- Modal content--\x3e\n                    <div class="modal-content">\n                        <div class="modal-header">\n                        <h4 class="modal-title" id="comment-${t._id}-like-title">Comment Reactions  \n                        <span>\n                       \n                        <i class="far fa-heart"></i>\n                      </span></h4>\n                        </div>\n                        <div class="modal-body">\n                            \n                            <ul  class="comment-like-username-list " id="comment-${t._id}-likes-list">\n                                    \n                            </ul>\n                        \n                        </div>\n                    \n                    </div>\n                    \n                    </div>\n            </div>\n\n                    \n        </div>\n        <small class="comment-deletion">\n        <span data-toggle="modal" data-target="#deleteCommentModal-${t._id}" class="delete-comment-modal">\n        <i class="fas fa-times"></i>\n    </span>\n    <div class="modal fade deletecommentmodal" tabindex="-1" role="dialog" id="deleteCommentModal-${t._id}" style="padding-right:0px;" >\n        <div class="modal-dialog" role="document">\n          <div class="modal-content">\n            <div class="modal-header">\n              <h2 class="modal-title"><i class="fas fa-trash-alt"></i> Comment?</h2>\n            </div>\n            <div class="modal-body">\n            <p style="text-align:left;">Are you sure you want to delete it? All the likes and replies will be lost forever.</p>\n            </div>\n            <div class="modal-footer">\n              <a href="/comments/destroy-comment/${t._id}" class="delete-comment-button btn btn-danger" data-dismiss="modal">Remove</a>\n              <button type="button" class="btn btn-light" data-dismiss="modal">Discard</button>\n            </div>\n          </div>\n        </div>\n      </div>\n        </small>\n        <small class="updatecommenttag"> \n            <a href="/comments/update-comment/${t._id}" class="update-comment-button" >\n                <i class="fas fa-marker"></i>\n            </a>\n        </small>\n        <div class="comment-content" id="comment-${t._id}-content">    \n                           \n            <div>    \n                <span class="comment-text"><span>${t.content}</span></span>\n                <br>\n                <small class="author-comment-name">\n                <a href="/users/profile/${t.user._id}">\n                    \n                    ${t.user.name}<span class="${t.authorTag}" style="width:45px;"> ${t.author}</span>\n                </a>\n                </small>\n                <br>\n                <span class="comment-timestamps">\n                        ${t.createdAt}\n                </span>\n            </div> \n        </div>   \n        <a class="comment-reply" href="/comments/replies/${t._id}">\n            <i class="fas fa-reply-all" title="View Replies" data-placement="top" data-toggle="tooltip"></i>\n        </a>\n    </li>`)}deleteComment(t){$(t).click((function(e){e.preventDefault(),console.log("inside delte button "),$.ajax({type:"get",url:$(t).prop("href"),success:function(t){console.log("remove comment: "),$("#comment-"+t.data.comment_id).remove();let e=parseInt($(`#post-${t.data.postID}-comment-number`).attr("data-comments"));console.log(e),e-=1,$(`#post-${t.data.postID}-comment-number`).attr("data-comments",e),e>0?($(`#post-${t.data.postID}-comment-number`).attr("data-toggle","collapse"),$(`#post-${t.data.postID}-comment-number`).html(`<span>${e}</span> <i class="fas fa-comments"></i>`)):($(`#post-${t.data.postID}-comment-number`).removeAttr("data-toggle"),$(`#post-${t.data.postID}-comment-number`).html('<span></span> <i class="fas fa-comments"></i>')),$(".modal-backdrop").remove(),$("body").removeClass("modal-open"),new Noty({theme:"relax",text:"See you, till the next time!",type:"success",layout:"topRight",timeout:1500}).show()},error:function(t){console.log(t.responseText)}})}))}updateComment(t){$(t).click((function(e){e.preventDefault(),$.ajax({type:"get",url:$(t).prop("href"),success:function(t){console.log(t.data),$(".post-comments-list>ul>li").each((function(){let t=$(this),e=$(" .updatecommenttag",t);$(" .update-comment-button",e).css("pointer-events","none"),e.css("cursor","no-drop")})),$(`#comment-${t.data.commentID} .comment-deletion`).css("cursor","no-drop"),$(`#comment-${t.data.commentID} .comment-deletion span`).css("pointer-events","none"),$(".post-comments>form").each((function(){let t=$(this);t.css("cursor","no-drop"),$(" button",t).css("pointer-events","none")})),$(`#comment-${t.data.commentID}-content > div .comment-text`).remove(),$(`#comment-${t.data.commentID}-content > div`).prepend(`<span class="comment-text" style="width:100%"><form action="/comments/update-comment-c2" method="post" class="comment-update-form">\n                    <textarea required  name="content" onkeydown="autosize1(this)">${t.data.content}</textarea>\n                    <input type="hidden" name="comment" value="${t.data.commentID}">\n                    <button type="submit">U</button>\n                    </form></span>`);$(".comment-update-form").submit((function(t){console.log("h2"),t.preventDefault(),$.ajax({type:"post",url:"/comments/update-comment-c2",data:$(".comment-update-form").serialize(),success:function(t){console.log(t.data),$(".post-comments-list>ul>li").each((function(){let t=$(this),e=$(" .updatecommenttag",t);$(" .update-comment-button",e).css("pointer-events","auto"),e.css("cursor","pointer")})),$(".post-comments>form").each((function(){let t=$(this);t.css("cursor","pointer"),$(" button",t).css("pointer-events","auto")})),$(`#comment-${t.data.commentID} .comment-deletion`).css("cursor","pointer"),$(`#comment-${t.data.commentID} .comment-deletion span`).css("pointer-events","auto"),t.data.edited&&$("#comment-"+t.data.commentID).prepend('<small class="comment-editedTag">\n                                        Edited\n                                        </small>'),$(`#comment-${t.data.commentID}-content .comment-text form`).remove(),$(`#comment-${t.data.commentID}-content .comment-text`).css("width","80%"),$(`#comment-${t.data.commentID}-content .comment-text`).prepend(`<span>${t.data.content}</span>`),$(`#comment-${t.data.commentID}-reply-content`).html(""+t.data.content),new Noty({theme:"relax",text:"This comment had a successful affair of words!",type:"success",layput:"topRight",timeout:1800}).show()},error:function(t){console.log(t.responseText)}})}))},error:function(t){console.log("error ",t.responseText)}})}))}}