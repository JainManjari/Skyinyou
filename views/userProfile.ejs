<link rel="stylesheet" href="/css/userProfile.css">
<link rel="stylesheet"  href="/css/chat.css">
<div id="stars-group-1"></div>
<div id="stars-group-2"></div>
<div id="stars-group-3"></div>
<div id="stars-group-4"></div>
    <h1 class="heading-background">
        <div>
            <div class="cloud" id="first-cloud"></div>
            <div class="cloud" id="second-cloud"></div>
            <div class="cloud" id="third-cloud"></div>
        <% if(user.id==profileUser.id) {%>
            <span>Your's Azure!</span>     
        <% } else {%>
            <span><%= profileUser.name %>'s Azure!</span>
        <% } %>
            <div class="cloud" id="four-cloud"></div>
            <div class="cloud" id="five-cloud"></div>
            <div class="cloud" id="six-cloud"></div>
            <div class="cloud" id="seven-cloud"></div>
            <div class="cloud" id="eight-cloud"></div>
        </div>
    </h1>

    <div class="profile-intro">
      <div class="first">
        <div class="accordion" id="accordionExample">
          <div class="card">
              <div class="card-header" id="headingOne">
                  <h2 class="mb-0">
                      <button type="button" class="collapsed" data-toggle="collapse" data-target="#collapseOne"><i class="far fa-handshake"></i> Amities</button>									
                  </h2>
              </div>
              <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
                  <div class="card-body">
                      <% if(friends.length>0) {%>
                            <% if(mutualfriends.length>0) {%>
                                <p  data-toggle="modal" data-target="#mutualfriendModal" style="cursor: pointer;">
                                    <%= mutualfriends.length%> 
                                    <% if(mutualfriends.length==1) {%>
                                        Mutual Connection
                                    <%} else {%>
                                        Mutual Connections
                                    <% } %> 
                                </p>
                            <% } %>
                            <p  data-toggle="modal" data-target="#friendModal" style="cursor: pointer;" class="normal-connections">
                                <%= friends.length%>
                                <% if(friends.length==1) {%>
                                    Connection 
                                <%} else {%>
                                    Connections
                                <% } %> 
                            </p>
                      <% } else {%>
                            <% if(user.id!=profileUser.id) {%>
                                <div>Well, Looks like you have to make the first move xD!</div>
                            <% } else { %>
                                <div>
                                    Are you ready for it?
                                </div>
                            <% } %>
                      <% } %>
                  </div>
              </div>
          </div>
          <div class="card">
              <div class="card-header" id="headingTwo">
                  <h2 class="mb-0">
                      <button type="button" class="collapsed"  data-toggle="collapse" data-target="#collapseTwo">What is Bootstrap?</button>
                  </h2>
              </div>
              <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
                  <div class="card-body">
                      <p>Bootstrap is a sleek, intuitive, and powerful front-end framework for faster and easier web development. It is a collection of CSS and HTML conventions. </p>
                  </div>
              </div>
          </div>
          <div class="card">
              <div class="card-header" id="headingThree">
                  <h2 class="mb-0">
                      <button type="button" class="collapsed" data-toggle="collapse" data-target="#collapseThree">What is CSS?</button>                     
                  </h2>
              </div>
              <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">
                  <div class="card-body">
                      <p>CSS stands for Cascading Style Sheet. CSS allows you to specify various style properties for a given HTML element such as colors, backgrounds, fonts etc. </p>
                  </div>
              </div>
          </div>
      </div>
   
      </div>

      <div class="middle">
        <% if(profileUser.avatar) {%>
            <img src="<%= profileUser.avatar %>" alt="<%= profileUser.name %>" width="100" height="100">
        <% } else if (profileUser.gender=="male"){%>
            <img src="https://i.stack.imgur.com/HQwHI.jpg" width="100" height="100">
        <% }  else {%>
            <img src="/images/femaleProfile.png" width="100" height="100">
        <% } %>
        <p class="profile-name"><%= profileUser.name %></p>
        <p class="profile-about">
            <span class="about-tag">About-</span>
            <% if(profileUser.info ) {%>
                <q><%= profileUser.info.about%></q>
            <% } %>
        </p>
        <% if(profileUser.id==user.id) {%>
            <span class="editprofile-tag">Edit Profile</span>
        <% } else {%>   
            <div class="add-chat-friend-group">
                <% if(!friended) {%>
                    <% if(!pendingFrom && !pendingTo) {%>
                        <a href="/users/friends-pending-form/?from=<%=user._id%>&to=<%=profileUser._id%>" class="add-friend-button">
                                Add Friend
                        </a>
                    <% } else if(pendingFrom) {%>
                        <span class="pending-from">Friend Request Pending</span>
                        <a href="/users/friends-cancel-form/?from=<%=user._id%>&to=<%=profileUser._id%>" class="cancel-friend-button">
                            Want to cancel it?
                        </a>
                    <% } else { %>
                        <span class="pending-form-present">Want to accept this friend request?</span>
                        <div class="pending-form-options">
                            <a href="/users/make-friends/?to=<%=user._id%>&from=<%=profileUser._id%>" class="confirm-friend-button">Confirm</a>
                            <a href="/users/friends-cancel-form/?to=<%=user._id%>&from=<%=profileUser._id%>" class="no-friend-button">Not Yet</a>
                        </div>
                    <% } %>
                <% } else {%>
                   
                    <div data-toggle="modal" data-target="#removeFriendModal" class="remove-friend-button-1">
                        Remove Friend
                    </div>
                 
                <% } %>
                
                <a href="#user-chat-box" class="chat-button">Chat with <%= profileUser.name  %></a>
            </div>
       
        <% } %>
      </div>
    

      <div></div>
    </div>
    <% if(friends.length>0) {%>
        <div class="modal fade" id="friendModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h2 class="modal-title" id="exampleModalLabel">
                    <%= friends.length%>
                    <% if(friends.length==1) {%>
                        Connection 
                    <%} else {%>
                        Connections
                    <% } %> 
                </h2>
                </div>
                <div class="modal-body">
                        <ul>
                            <% for(friend of friends) {%>
                                <li id="user-<%= friend._id%>" class="friend-list">
                                    <%- include("_friendDisplay"); %>
                                </li>
                                
                            <% } %>
                        </ul>
                </div>
                
            </div>
            </div>
        </div>
        <% if(user.id==profileUser.id) { %>
            <% for (friend of friends) {%>
                <div class="modal fade delete-friend-warning" id="deleteFriendModal-<%= friend._id %>" data-backdrop="static" >
                    <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                        <h2 class="modal-title"><i class="fas fa-trash-alt"></i> Buddy?</h2>
                        </div>
                        <div class="modal-body">
                        <p>Are you sure you want to remove <b><%= friend.name%></b> from your sky? </p>
                        </div>
                        <div class="modal-footer">
                            <a href="/users/destroy-friends/true/?from=<%=user._id%>&to=<%=friend._id%>" class="remove-friend-button">
                                <i class="fas fa-handshake-slash"></i>
                        </a>
                        <a data-dismiss="modal" class="discard-friend">Discard</a>
                        </div>
                    </div>
                    </div>
                </div>
            <% } %>
        <% } else {%>
            <div class="modal fade" id="mutualfriendModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                    <h2 class="modal-title" id="exampleModalLabel">
                        <%= mutualfriends.length%>
                        <% if(mutualfriends.length==1) {%>
                            Mutual Connection 
                        <%} else {%>
                            Mutual 
                            Connections
                        <% } %> 
                    </h2>
                    </div>
                    <div class="modal-body">
                            <ul>
                                <% for(friend of mutualfriends) {%>
                                    <li id="user-<%=friend._id%>" class="friend-list">
                                        <%- include("_friendDisplay"); %>
                                    </li>
                                    
                                <% } %>
                            </ul>
                    </div>
                    
                </div>
                </div>
            </div>
        <% } %>
      
    <% } %>
    <% if(user.id!=profileUser.id && friended) {%>
      <div class="modal fade remove-friend-warning" id="removeFriendModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="removeFriendModalLabel"><i class="fas fa-trash-alt"></i> Buddy?</h5>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to remove <b><%= profileUser.name%></b> from your sky? </p>
            </div>
            <div class="modal-footer">
                <a href="/users/destroy-friends/false/?from=<%= user._id %>&to=<%= profileUser._id %>" class="btn btn-primary remove-friend-button">
                        Remove Friend
                </a>
                <button type="button" class="btn discard-friend" data-dismiss="modal">Discard</button>
            </div>
          </div>
        </div>
      </div>
    <% } %>
    <% if(user.id==profileUser.id) { %> 
       
        <!-- <form action="/users/update/<%= profileUser.id %>" method="post" enctype="multipart/form-data">
            <input type="text" required placeholder="Your Name..." value="<%= profileUser.name %>" name="name">
            <input type="email" required placeholder="Your Email..." value="<%= profileUser.email %>" name="email">
            <input type="file" name="avatar" placeholder="Profile Picture...">
            <button type="submit">Update</button>
        </form> -->
        <br>
        <br><br>
        <form id="new-post-form" method="post" action="/posts/create-post">
            <textarea name="content" id="new-post-content" required cols="30" rows="3" placeholder="Type here..."></textarea>
            <br>
            <button type="submit">Post</button>
        </form>
        <br><br>
    
        <% if(posts.length!=0) { %>
            <h3 style="text-align: center;">The Sky In You!</h3>
            <br>
            <div id="posts-list-container">
                <ul>
                    <% for(i of posts) { %>
                        <%- include('_post') -%>
                                    
                    <% } %>
                </ul>
            </div>
        <% } else { %>
            <h3 style="text-align: center;">You have yet to ascent!</h3>
        <% } %>
            
    <% } else { %>

          
                        <br>
            <br>
        
            <% if(posts.length!=0) { %>
                <h3 style="text-align: center;">The Sky In <%= profileUser.name%>!</h3>
                <br>
                <div id="posts-list-container">
                    <ul>
                        <% for(i of posts) { %>
                            <%- include('_post') -%>
                                        
                        <% } %>
                    </ul>
                </div>
            <% } else { %>
                <h3 style="text-align: center;">This amazing person has yet to ascent!</h3>
            <% } %>

            <%- include("_chat"); %>
    <% } %>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
    <script src="/js/friends.js"></script>
    <script>
        new ChatEngine('user-chat-box','<%= locals.user.email %>');
    </script>


